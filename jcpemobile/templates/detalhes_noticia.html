{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- Meta Tags Essenciais -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- SEO e Meta Informações -->
    <meta name="description" content="Jornal do Commercio - O mais tradicional veículo de comunicação de Pernambuco. Notícias, reportagens e cobertura completa.">
    <meta name="keywords" content="notícias, pernambuco, recife, jornal, commercio, jc, política, economia, esportes">
    <meta name="author" content="Jornal do Commercio">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="{{ noticia.titulo }} - Jornal do Commercio">
    <meta property="og:description" content="{{ noticia.resumo|default:noticia.titulo }}">
    {% if noticia.imagem %}
    <meta property="og:image" content="{{ noticia.imagem.url }}">
    {% else %}
    <meta property="og:image" content="{% static 'images/logo-jc.png' %}">
    {% endif %}

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'images/jc-favicon.png' %}">

    <!-- Título -->
    <title>{{ noticia.titulo }} - Jornal do Commercio</title>

    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- CSS - Ordem Importante -->
    <link rel="stylesheet" href="{% static 'css/reset.css' %}">
    <link rel="stylesheet" href="{% static 'css/variaveis.css' %}">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="{% static 'css/componentes.css' %}">
    <link rel="stylesheet" href="{% static 'css/layout.css' %}">
    <link rel="stylesheet" href="{% static 'css/home-layout.css' %}">
    <link rel="stylesheet" href="{% static 'css/responsivo.css' %}">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body {% if user.is_authenticated %}data-usuario-autenticado{% endif %}>
    <!-- Barra Superior UOL -->
    <div class="barra-uol">
        <div class="barra-uol-container">
            <a href="https://www.uol.com.br" target="_blank" rel="noopener noreferrer">
                <img src="{% static 'images/Uol.png' %}" alt="UOL" class="logo-uol">
            </a>
        </div>
    </div>
    
    <div class="top-bar"></div>

    <!-- Cabeçalho -->
    <header class="cabecalho" id="cabecalho">
        <div class="cabecalho-container">
            <!-- Menu Hamburguer (Mobile) -->
            <button class="menu-hamburguer" id="menuHamburguer" aria-label="Abrir menu">
                <span class="hamburguer-linha"></span>
                <span class="hamburguer-linha"></span>
                <span class="hamburguer-linha"></span>
            </button>

            <!-- Logo -->
            <div class="logo">
                <a href="{% url 'index' %}" title="Jornal do Commercio - Página Inicial">
                    <img src="{% static 'images/logo-jc.png' %}" alt="Jornal do Commercio" class="logo-imagem">
                </a>
            </div>

            <!-- Ações do Cabeçalho -->
            <div class="cabecalho-acoes">
                <!-- Busca -->
                <button class="botao-busca" id="botaoBusca" aria-label="Buscar">
                    <i class="fas fa-search"></i>
                </button>

                <!-- Perfil -->
                <button class="botao-perfil" id="botaoPerfil" aria-label="Meu perfil">
                    <img src="{% static 'images/Radio_Fill.png' %}" alt="Meu perfil" class="icone-radio">
                </button>
            </div>
        </div>

        <!-- Barra de Busca (Expansível) -->
        <div class="barra-busca" id="barraBusca" aria-hidden="true">
            <div class="busca-container">
                <input type="search"
                       class="campo-busca"
                       placeholder="Buscar notícias..."
                       aria-label="Buscar notícias">
                <button class="botao-filtros" aria-label="Filtros de busca">
                    <i class="fas fa-filter"></i>
                </button>
            </div>

            <!-- Filtros de Busca -->
            <div class="filtros-busca" id="filtrosBusca">
                <select class="filtro-data" aria-label="Filtrar por data">
                    <option value="">Todas as datas</option>
                    <option value="hoje">Hoje</option>
                    <option value="semana">Esta semana</option>
                    <option value="mes">Este mês</option>
                </select>

                <select class="filtro-categoria" aria-label="Filtrar por categoria">
                    <option value="">Todas as categorias</option>
                    <option value="pernambuco">Pernambuco</option>
                    <option value="politica">Política</option>
                    <option value="economia">Economia</option>
                    <option value="esportes">Esportes</option>
                    <option value="cultura">Cultura</option>
                </select>

                <select class="filtro-ordenar" aria-label="Ordenar por">
                    <option value="relevancia">Mais relevantes</option>
                    <option value="recentes">Mais recentes</option>
                    <option value="antigas">Mais antigas</option>
                </select>
            </div>
        </div>
    </header>

    <!-- Menu Lateral -->
    <nav class="menu-lateral" id="menuLateral" aria-label="Menu principal">
        <div class="menu-lateral-cabecalho">
            <div class="menu-hamburguer-icone">
                <i class="fas fa-bars"></i>
            </div>
            <button class="menu-lateral-fechar" id="menuLateralFechar" aria-label="Fechar menu">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="menu-lateral-conteudo">
            <!-- Perfil do Usuário (se logado) -->
            <div class="menu-lateral-perfil">
                <img src="{% static 'images/Profile.png' %}" alt="Perfil" class="icone-perfil">
                <div class="perfil-info">
                    <span class="perfil-nome">Visitante</span>
                    <a href="#entrar" class="perfil-link">Entrar / Cadastrar</a>
                </div>
            </div>

            <!-- Menu Principal -->
            <ul class="menu-principal">
                <!-- Categorias -->
                <li class="menu-item menu-item-expansivel">
                    <button class="menu-link" aria-expanded="false">
                        <i class="fas fa-newspaper"></i>
                        <span>Categorias</span>
                        <i class="fas fa-chevron-down menu-seta"></i>
                    </button>
                    <ul class="submenu">
                        <li><a href="#pernambuco">Pernambuco</a></li>
                        <li><a href="#politica">Política</a></li>
                        <li><a href="#economia">Economia</a></li>
                        <li><a href="#mundo">Mundo</a></li>
                        <li><a href="#esportes">Esportes</a></li>
                        <li><a href="#cultura">Cultura</a></li>
                        <li><a href="#educacao">Educação</a></li>
                        <li><a href="#mobilidade">Mobilidade</a></li>
                    </ul>
                </li>

                <!-- Seções Especiais -->
                <li class="menu-item">
                    <a href="{% url 'mais_lidas' %}" class="menu-link">
                        <img src="{% static 'images/Fire@3x.png' %}" alt="Mais Lidas" class="icone-fire">
                        <span>Mais Lidas</span>
                    </a>
                </li>

                <li class="menu-item">
                    <a href="#neels" class="menu-link">
                        <img src="{% static 'images/NFC.png' %}" alt="Neels" class="icone-nfc">
                        <span>Neels</span>
                    </a>
                </li>

                <li class="menu-item">
                    <a href="#curtas" class="menu-link">
                        <i class="fas fa-bolt"></i>
                        <span>Curtas</span>
                    </a>
                </li>

                <li class="menu-item">
                    <a href="#linha-tempo" class="menu-link">
                        <i class="fas fa-clock"></i>
                        <span>Linha do Tempo</span>
                    </a>
                </li>

                <!-- Canais -->
                <li class="menu-item menu-item-expansivel">
                    <button class="menu-link" aria-expanded="false">
                        <i class="fas fa-tv"></i>
                        <span>Canais</span>
                        <i class="fas fa-chevron-down menu-seta"></i>
                    </button>
                    <ul class="submenu">
                        <li><a href="#tv-jornal">TV Jornal</a></li>
                        <li><a href="#radio-jornal">Rádio Jornal</a></li>
                        <li><a href="#podcasts">Podcasts</a></li>
                    </ul>
                </li>

                <!-- Outras Seções -->
                <li class="menu-item">
                    <a href="#jornal-digital" class="menu-link">
                        <i class="fas fa-tablet-alt"></i>
                        <span>Jornal Digital</span>
                    </a>
                </li>

                <li class="menu-item">
                    <a href="{% url 'salvos' %}" class="menu-link">
                        <i class="fas fa-bookmark"></i>
                        <span>Notícias Salvas</span>
                    </a>
                </li>
            </ul>

            <!-- Links Secundários -->
            <div class="menu-lateral-rodape">
                <a href="#sobre">Sobre o JC</a>
                <a href="#fale-conosco">Fale Conosco</a>
                <a href="#anuncie">Anuncie</a>
                <a href="#privacidade">Privacidade</a>
            </div>
        </div>
    </nav>

    <!-- Overlay do Menu -->
    <div class="menu-overlay" id="menuOverlay"></div>

    <!-- Conteúdo Principal -->
    <main class="conteudo-principal" id="conteudoPrincipal">
        <div class="container">
            <!-- Breadcrumb -->
            <nav class="breadcrumb" aria-label="Navegação por breadcrumb">
                <a href="{% url 'index' %}">Início</a>
                <span class="breadcrumb-separador">/</span>
                <a href="#">{{ noticia.categoria.nome|default:'Notícias' }}</a>
                <span class="breadcrumb-separador">/</span>
                <span class="breadcrumb-atual">{{ noticia.titulo|truncatewords:5 }}</span>
            </nav>

            <!-- Artigo da Notícia -->
            <article class="artigo-noticia">
                <!-- Cabeçalho da Notícia -->
                <header class="artigo-cabecalho">
                    <div class="artigo-meta">
                        <span class="badge-categoria-inline badge-{{ noticia.categoria.slug|default:'pernambuco' }}">
                            {{ noticia.categoria.nome|default:'Notícias' }}
                        </span>
                        <time class="artigo-data" datetime="{{ noticia.data_publicacao|date:'Y-m-d' }}">
                            {{ noticia.data_publicacao|date:"d/m/Y" }} - {{ noticia.data_publicacao|timesince }} atrás
                        </time>
                    </div>

                    <h1 class="artigo-titulo">{{ noticia.titulo }}</h1>

                    {% if noticia.resumo %}
                    <p class="artigo-resumo">{{ noticia.resumo }}</p>
                    {% endif %}

                    <div class="artigo-autor-info">
                        <i class="fas fa-user-circle"></i>
                        <span>Por <strong>{{ noticia.autor.nome|default:'Redação JC' }}</strong></span>
                        <span class="separador">•</span>
                        <i class="fas fa-eye"></i>
                        <span>{{ noticia.visualizacoes.count }} visualizações</span>
                    </div>
                </header>

                <!-- Imagem Principal -->
                {% if noticia.imagem %}
                <div class="artigo-imagem-principal">
                    <img src="{{ noticia.imagem.url }}" alt="{{ noticia.titulo }}" loading="lazy">
                </div>
                {% endif %}

                <!-- Barra de Ações -->
                <div class="artigo-acoes">
                    <button class="botao-acao" id="botaoCompartilhar" title="Compartilhar">
                        <i class="fas fa-share-alt"></i>
                        <span>Compartilhar</span>
                    </button>
                    <button class="botao-acao {% if noticia_salva %}salvo{% endif %}" 
                            id="botaoSalvar" 
                            title="{% if noticia_salva %}Remover dos salvos{% else %}Salvar para ler depois{% endif %}"
                            data-noticia-id="{{ noticia.id }}"
                            data-salva="{% if noticia_salva %}true{% else %}false{% endif %}">
                        <i class="{% if noticia_salva %}fas{% else %}far{% endif %} fa-bookmark"></i>
                        <span>{% if noticia_salva %}Salvo{% else %}Salvar{% endif %}</span>
                    </button>
                    <button class="botao-acao" id="botaoTamanhoFonte" title="Aumentar tamanho da fonte">
                        <i class="fas fa-text-height"></i>
                        <span>Tamanho</span>
                    </button>
                </div>

                <!-- Conteúdo da Notícia -->
                <div class="artigo-conteudo">
                    {{ noticia.conteudo|linebreaks }}
                </div>

                <!-- Tags -->
                {% if noticia.tags.exists %}
                <div class="artigo-tags">
                    <i class="fas fa-tags"></i>
                    {% for tag in noticia.tags.all %}
                        <a href="#" class="tag">{{ tag.nome }}</a>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Voltar -->
                <div class="artigo-navegacao" style="margin-top: 30px;">
                    <a href="{% url 'index' %}" class="botao-voltar">
                        <i class="fas fa-arrow-left"></i> Voltar para página inicial
                    </a>
                </div>
            </article>
        </div>
    </main>

    <!-- Navegação Inferior (Mobile) -->
    <nav class="navegacao-inferior" id="navegacaoInferior" aria-label="Navegação rápida">
        <a href="{% url 'index' %}" class="nav-item">
            <img src="{% static 'images/Home.png' %}" alt="Início" class="icone-home">
            <span>Início</span>
        </a>
        <a href="{% url 'mais_lidas' %}" class="nav-item">
            <img src="{% static 'images/Fire@3x.png' %}" alt="Mais Lidas" class="icone-fire">
            <span>Mais Lidas</span>
        </a>
        <a href="#neels" class="nav-item">
            <img src="{% static 'images/NFC.png' %}" alt="Neels" class="icone-nfc">
            <span>Neels</span>
        </a>
        <a href="#perfil" class="nav-item">
            <img src="{% static 'images/Radio_Fill.png' %}" alt="Ao vivo" class="icone-radio">
            <span>Ao vivo</span>
        </a>
    </nav>

    <!-- Rodapé -->
    <footer class="rodape" id="rodape">
        <div class="rodape-conteudo">
            <div class="rodape-logo">
                <img src="{% static 'images/logo-jc.png' %}" alt="Jornal do Commercio">
                <p>O jornal mais tradicional de Pernambuco</p>
            </div>
        </div>

        <div class="rodape-copyright">
            <p>&copy; 2025 Jornal do Commercio. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="{% static 'js/app.js' %}"></script>
    <script src="{% static 'js/navegacao.js' %}"></script>
    
    <script>
        // JavaScript para botão de salvar notícia
        document.addEventListener('DOMContentLoaded', function() {
            const botaoSalvar = document.getElementById('botaoSalvar');
            
            if (botaoSalvar) {
                botaoSalvar.addEventListener('click', function() {
                    const noticiaId = this.getAttribute('data-noticia-id');
                    const estaSalva = this.getAttribute('data-salva') === 'true';
                    
                    // Verificar se o usuário está autenticado
                    if (!document.body.hasAttribute('data-usuario-autenticado')) {
                        alert('Você precisa estar logado para salvar notícias.');
                        const botaoPerfil = document.getElementById('botaoPerfil');
                        if (botaoPerfil) {
                            botaoPerfil.click();
                        }
                        return;
                    }
                    
                    const url = estaSalva 
                        ? `/noticia/${noticiaId}/remover/` 
                        : `/noticia/${noticiaId}/salvar/`;
                    
                    const icone = this.querySelector('i');
                    const texto = this.querySelector('span');
                    
                    // Desabilita o botão durante a requisição
                    this.disabled = true;
                    
                    fetch(url, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': getCookie('csrftoken'),
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Atualiza o estado do botão
                            if (data.salva) {
                                this.setAttribute('data-salva', 'true');
                                icone.classList.remove('far');
                                icone.classList.add('fas');
                                texto.textContent = 'Salvo';
                                this.classList.add('salvo');
                                this.title = 'Remover dos salvos';
                            } else {
                                this.setAttribute('data-salva', 'false');
                                icone.classList.remove('fas');
                                icone.classList.add('far');
                                texto.textContent = 'Salvar';
                                this.classList.remove('salvo');
                                this.title = 'Salvar para ler depois';
                            }
                            
                            // Mostra mensagem de feedback
                            mostrarNotificacao(data.message, 'success');
                        } else {
                            mostrarNotificacao(data.message || 'Erro ao processar requisição.', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Erro:', error);
                        mostrarNotificacao('Erro ao processar requisição. Tente novamente.', 'error');
                    })
                    .finally(() => {
                        this.disabled = false;
                    });
                });
            }
        });

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        function mostrarNotificacao(mensagem, tipo) {
            const notificacaoExistente = document.querySelector('.notificacao-salvar');
            if (notificacaoExistente) {
                notificacaoExistente.remove();
            }
            
            const notificacao = document.createElement('div');
            notificacao.className = `notificacao-salvar notificacao-${tipo}`;
            notificacao.innerHTML = `
                <i class="fas fa-${tipo === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <span>${mensagem}</span>
            `;
            
            const styles = document.createElement('style');
            styles.textContent = `
                .notificacao-salvar {
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    padding: 15px 20px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    z-index: 10000;
                    animation: slideInRight 0.3s ease-out;
                    font-size: 0.95rem;
                    font-weight: 500;
                }
                .notificacao-success { background-color: #10b981; color: white; }
                .notificacao-error { background-color: #ef4444; color: white; }
                .notificacao-salvar i { font-size: 1.2rem; }
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                .botao-acao.salvo {
                    background-color: var(--cor-primaria, #0066cc);
                    color: white;
                }
            `;
            if (!document.getElementById('notificacao-styles')) {
                styles.id = 'notificacao-styles';
                document.head.appendChild(styles);
            }
            
            document.body.appendChild(notificacao);
            
            setTimeout(() => {
                notificacao.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => notificacao.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>
